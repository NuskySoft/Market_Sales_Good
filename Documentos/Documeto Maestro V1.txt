# DOCUMENTO MAESTRO - MARKET SALES

## üì± **INFORMACI√ìN DEL PROYECTO**

### **Nombre del Proyecto:** Market Sales
### **Package Name:** es.nuskysoftware.marketsales
### **Descripci√≥n:** Aplicaci√≥n para control de caja espec√≠ficamente dise√±ada para vendedores ambulantes en mercadillos
### **Estado Actual:** En desarrollo - Fase de migraci√≥n desde Caja Mercadillos

---

## üéØ **CAMBIOS FUNDAMENTALES RESPECTO AL PROYECTO ORIGINAL**

### **1. NUEVO FLUJO DE NAVEGACI√ìN**
- **ANTES:** Splash ‚Üí Verificar isConfigured ‚Üí Configuraci√≥n/Home ‚Üí Mercadillos
- **AHORA:** Splash ‚Üí Crear configuraci√≥n autom√°tica ‚Üí Mercadillos (pantalla principal)
- **ELIMINADO:** PantallaHome como intermediaria
- **A√ëADIDO:** Men√∫ hamburguesa como navegaci√≥n principal

### **2. MEN√ö HAMBURGUESA (Nueva navegaci√≥n)**
**Opciones del men√∫:**
- Mercadillos (principal)
- Art√≠culos
- Categor√≠as  
- Listados
- Configuraci√≥n
- Login/Logout (condicional seg√∫n autenticaci√≥n)
- Salir

### **3. CAMBIOS EN ConfiguracionEntity**
```kotlin
// ELIMINADO:
val isConfigurated: Boolean = false  // Ya no se necesita
val controlStock: Int = 0           // Se maneja en PantallaArticulos
val controlCoste: Int = 0           // Se maneja en PantallaArticulos

// CAMBIADO:
val versionApp: String = "FREE"     // ANTES
val versionApp: Int = 0             // AHORA (0=FREE, 1=PREMIUM)
```

### **4. SISTEMA DE PERSONALIZACI√ìN COMPLETO**
- **Idiomas:** Espa√±ol/Ingl√©s con strings.xml
- **Fuentes:** Montserrat, Poppins, Roboto (selecci√≥n din√°mica)
- **Temas:** Claro/Oscuro din√°mico
- **Integraci√≥n:** Todo controlado desde ConfiguracionEntity

---

## üèóÔ∏è **PLAN DE DESARROLLO COMPLETO**

### **PASO 1: Crear Proyecto Base** ‚úÖ COMPLETADO
- [x] Crear proyecto Market Sales
- [x] Configurar Firebase con SHA-1: `DF:92:0E:75:F9:07:5B:A4:C7:47:5B:04:A9:88:17:C6:90:8A:2D:8A`
- [x] Copiar archivos gradle (funcionando)
- [x] Sincronizar proyecto exitosamente

### **PASO 2: Navegaci√≥n Base + ConfiguracionEntity** ‚è≥ EN PROGRESO
**Archivos a crear:**
1. `ConfiguracionEntity.kt` (sin controlStock/controlCoste)
2. `ConfiguracionDao.kt` (copiar original)
3. `AppDatabase.kt` (solo configuraci√≥n inicialmente)
4. `ConfiguracionRepository.kt`
5. `ConfiguracionViewModel.kt` 
6. `PantallaSplash.kt` (nuevo flujo ‚Üí mercadillos)
7. `PantallaMercadillos.kt` (b√°sica, sin datos)
8. `MainActivity.kt` (tema din√°mico)

### **PASO 3: Men√∫ Hamburguesa Reutilizable**
1. Crear componente `MenuHamburguesa.kt`
2. Actualizar `HeaderBar.kt` para soporte de men√∫
3. Implementar `DrawerNavigation.kt`
4. Integrar en todas las pantallas principales

### **PASO 4: Opciones del Men√∫ Funcionando**
1. Navegaci√≥n a Mercadillos ‚úÖ
2. Navegaci√≥n a Art√≠culos
3. Navegaci√≥n a Categor√≠as
4. Navegaci√≥n a Listados (placeholder)
5. Navegaci√≥n a Configuraci√≥n
6. Login/Logout (placeholder)
7. Funcionalidad Salir

### **PASO 5: Sistema de Personalizaci√≥n**
**5.1 Fuentes Din√°micas:**
- `Type.kt` con m√∫ltiples familias tipogr√°ficas
- `MarketSalesTheme` con par√°metro fuente
- Integraci√≥n con ConfiguracionEntity

**5.2 Idiomas (Internacionalizaci√≥n):**
- `res/values/strings.xml` (espa√±ol)
- `res/values-en/strings.xml` (ingl√©s)
- `LocaleManager.kt` para cambio din√°mico
- Migrar todos los textos hardcodeados

**5.3 Tema Claro/Oscuro:**
- `MarketSalesTheme` con par√°metro darkTheme
- Aplicaci√≥n autom√°tica desde ConfiguracionEntity
- Testing en todas las pantallas

### **PASO 6: Autenticaci√≥n (Firebase Auth)**
1. Firebase Auth setup
2. Google OAuth implementation
3. `AuthViewModel` + `AuthRepository`
4. Pantalla Login/Register
5. Integraci√≥n con men√∫ hamburguesa
6. Control de acceso a funcionalidades Premium

### **PASO 7: Migrar Funcionalidades Existentes**
1. **Categor√≠as:** Homogeneizar UI con modelo PantallaArticulos
2. **Art√≠culos:** Migrar con l√≥gica Premium existente
3. **Sistema de avisos:** Migrar campanita y funcionalidad
4. Aplicar men√∫ hamburguesa, idiomas y fuentes a todo

### **PASO 8: Nuevas Funcionalidades**
1. Sistema de mercadillos completo
2. Ventas con recibos (email/SMS/WhatsApp)
3. Gastos y arqueos
4. Listados y reportes
5. Funcionalidades Premium avanzadas

---

## üîç **AN√ÅLISIS DEL C√ìDIGO EXISTENTE**

### **üìä ESTADO GENERAL: MUY BUENO** ‚úÖ

#### **M√ìDULOS 100% REUTILIZABLES:**
- ‚úÖ **DAOs:** Todos perfectos (ArticuloDao, CategoriaDao, AvisoDao)
- ‚úÖ **Entities:** ArticuloEntity, CategoriaEntity, AvisoEntity
- ‚úÖ **Repositories:** Patr√≥n offline-first implementado perfectamente
- ‚úÖ **ViewModels:** Todos excelentes y reutilizables
- ‚úÖ **Componentes UI:** BotonHome, CampanaAvisos, CustomDialogConfirmacion
- ‚úÖ **Utils:** EstadosMercadillo, FooterMarca, NetworkMonitor

#### **MODELO A SEGUIR: PantallaArticulos** üéØ
**Esta pantalla es PERFECTA:**
- ‚úÖ Ya incluye verificaci√≥n Premium: `esPremium = configuracion?.versionApp?.trim()?.uppercase() == "PREMIUM"`
- ‚úÖ UI responsive con orientaci√≥n
- ‚úÖ LazyColumn con Cards perfectas
- ‚úÖ HeaderBar con campana funcionando
- ‚úÖ DialogoNuevoArticulo con l√≥gica Premium completa
- ‚úÖ Sistema de FAB posicionado correctamente

#### **CAMBIOS NECESARIOS:**
- üîÑ **PantallaCategorias:** Homogeneizar layout con PantallaArticulos
- üîÑ **PantallaMercadillos:** Cambiar `mostrarBack = true` ‚Üí men√∫ hamburguesa
- üîÑ **ConfiguracionEntity:** Aplicar cambios definidos

---

## üìÅ **ESTRUCTURA DE DIRECTORIOS MARKET SALES**

```
app/src/main/java/es/nuskysoftware/marketsales/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ local/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dao/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfiguracionDao.kt ‚úÖ (copiar)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaDao.kt üìã (futuro)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArticuloDao.kt üìã (futuro)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AvisoDao.kt üìã (futuro)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfiguracionEntity.kt üîÑ (modificada)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaEntity.kt üìã (futuro)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArticuloEntity.kt üìã (futuro)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AvisoEntity.kt üìã (futuro)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ AppDatabase.kt üîÑ (solo configuraci√≥n inicial)
‚îÇ   ‚îî‚îÄ‚îÄ repository/
‚îÇ       ‚îú‚îÄ‚îÄ ConfiguracionRepository.kt ‚úÖ (copiar)
‚îÇ       ‚îî‚îÄ‚îÄ [otros repositories] üìã (futuro)
‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îú‚îÄ‚îÄ theme/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Color.kt ‚úÖ (copiar)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CustomColors.kt ‚úÖ (copiar)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Shape.kt ‚úÖ (copiar)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Type.kt üîÑ (m√∫ltiples fuentes)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Theme.kt üîÑ (tema din√°mico)
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MenuHamburguesa.kt üìù (nuevo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HeaderBar.kt üîÑ (soporte men√∫)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [otros componentes] üìã (futuro)
‚îÇ   ‚îú‚îÄ‚îÄ pantallas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PantallaSplash.kt üîÑ (nuevo flujo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PantallaMercadillos.kt üîÑ (men√∫ hamburguesa)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [otras pantallas] üìã (futuro)
‚îÇ   ‚îî‚îÄ‚îÄ viewmodel/
‚îÇ       ‚îú‚îÄ‚îÄ ConfiguracionViewModel.kt ‚úÖ (copiar)
‚îÇ       ‚îî‚îÄ‚îÄ [otros viewmodels] üìã (futuro)
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ LocaleManager.kt üìù (nuevo - idiomas)
‚îÇ   ‚îú‚îÄ‚îÄ FontManager.kt üìù (nuevo - fuentes)
‚îÇ   ‚îî‚îÄ‚îÄ [otros utils] üìã (futuro)
‚îî‚îÄ‚îÄ MainActivity.kt üîÑ (tema din√°mico)
```

**Leyenda:**
- ‚úÖ Copiar tal cual
- üîÑ Copiar con modificaciones
- üìù Crear nuevo
- üìã Migrar en fases posteriores

---

## üé® **SISTEMA DE PERSONALIZACI√ìN DEFINIDO**

### **FUENTES DISPONIBLES:**
1. **Montserrat** (default)
2. **Poppins** 
3. **Roboto**
4. [2 fuentes m√°s por determinar]

### **IDIOMAS SOPORTADOS:**
1. **Espa√±ol** (es) - default
2. **Ingl√©s** (en)

### **TEMAS:**
1. **Claro** (default)
2. **Oscuro**

### **INTEGRACI√ìN EN ConfiguracionEntity:**
```kotlin
val idioma: String = "es"           // es/en
val temaOscuro: Boolean = false     // true/false
val fuente: String = "Montserrat"   // Montserrat/Poppins/Roboto
```

---

## üîë **ARCHIVOS CLAVE PENDIENTES DE CREAR**

### **ConfiguracionEntity.kt (Prioridad 1)**
```kotlin
@Entity(tableName = "configuracion")
data class ConfiguracionEntity(
    @PrimaryKey val id: Int = 1,
    val versionApp: Int = 0,         // ‚úÖ CAMBIO: Int en vez de String
    val numeroVersion: String = "V1.0",
    // ‚ùå ELIMINADO: isConfigurated, controlStock, controlCoste
    val ultimoDispositivo: String? = null,
    val usuarioEmail: String? = null,
    val usuarioId: String? = null,
    val idioma: String = "es",       // ‚úÖ Para internacionalizaci√≥n
    val temaOscuro: Boolean = false, // ‚úÖ Para tema din√°mico
    val fuente: String = "Montserrat", // ‚úÖ Para fuentes din√°micas
    val moneda: String = "‚Ç¨ Euro",
    val fechaUltimaSync: String? = null
)
```

### **Theme.kt (Prioridad 1)**
```kotlin
@Composable
fun MarketSalesTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    fuente: String = "Montserrat",  // ‚úÖ Par√°metro din√°mico
    content: @Composable () -> Unit
) {
    val typography = when (fuente) {
        "Montserrat" -> MontserratTypography
        "Poppins" -> PoppinsTypography
        "Roboto" -> RobotoTypography
        else -> MontserratTypography
    }
    // Aplicar tema y tipograf√≠a din√°micamente
}
```

### **PantallaSplash.kt (Prioridad 1)**
```kotlin
LaunchedEffect(config) {
    delay(1500)
    
    // Si no existe configuraci√≥n, crear por defecto
    if (config == null) {
        configuracionViewModel.guardarConfiguracion(
            ConfiguracionEntity(versionApp = 0) // FREE
        )
    }
    
    // ‚úÖ SIEMPRE ir a mercadillos
    navController.navigate("mercadillos") {
        popUpTo("splash") { inclusive = true }
    }
}
```

---

## üöÄ **PR√ìXIMOS PASOS INMEDIATOS**

### **AL CONTINUAR EN NUEVO CHAT:**

1. **Crear estructura de directorios** en proyecto Market Sales
2. **Implementar ConfiguracionEntity actualizada**
3. **Crear AppDatabase m√≠nimo** (solo configuraci√≥n)
4. **Implementar PantallaSplash** con nuevo flujo
5. **Crear PantallaMercadillos b√°sica** (sin datos)
6. **Implementar tema din√°mico** en MainActivity

### **ORDEN SUGERIDO DE CREACI√ìN:**
1. ConfiguracionEntity.kt
2. ConfiguracionDao.kt (copiar)
3. AppDatabase.kt (minimal)
4. ConfiguracionRepository.kt (copiar)
5. ConfiguracionViewModel.kt (copiar)
6. Type.kt (m√∫ltiples fuentes)
7. Theme.kt (din√°mico)
8. PantallaSplash.kt (nuevo flujo)
9. PantallaMercadillos.kt (b√°sica)
10. MainActivity.kt (tema din√°mico)

---

## üìù **DECISIONES T√âCNICAS IMPORTANTES**

### **1. Control Stock/Coste**
- **Eliminado de ConfiguracionEntity**
- **Se maneja directamente en PantallaArticulos**
- **L√≥gica Premium ya implementada en DialogoNuevoArticulo**

### **2. Navegaci√≥n Principal**
- **Mercadillos = pantalla principal** (no Home)
- **Men√∫ hamburguesa = navegaci√≥n universal**
- **HeaderBar reutilizable con soporte men√∫**

### **3. Personalizaci√≥n**
- **Tema din√°mico** aplicado desde MainActivity
- **Fuentes din√°micas** en MarketSalesTheme
- **Idiomas** con sistema strings.xml est√°ndar

### **4. Firebase SHA-1**
- **Debug SHA-1:** `DF:92:0E:75:F9:07:5B:A4:C7:47:5B:04:A9:88:17:C6:90:8A:2D:8A`
- **Proyecto Firebase:** Nuevo proyecto "Market Sales"
- **Package:** es.nuskysoftware.marketsales

---

## üéØ **ESTADO DEL PROYECTO**

### **‚úÖ COMPLETADO:**
- An√°lisis completo del c√≥digo existente
- Plan de desarrollo estructurado
- Decisiones t√©cnicas tomadas
- Proyecto Firebase configurado
- Estructura base definida

### **‚è≥ EN PROGRESO:**
- Creaci√≥n de archivos base
- Implementaci√≥n de navegaci√≥n m√≠nima
- Sistema de personalizaci√≥n

### **üìã PENDIENTE:**
- Men√∫ hamburguesa
- Autenticaci√≥n Firebase
- Migraci√≥n funcionalidades existentes
- Nuevas funcionalidades (ventas, gastos, etc.)

---

## üìû **INFORMACI√ìN DE CONTACTO DEL PROYECTO**

- **Developer:** Nusky Software
- **Proyecto anterior:** Caja Mercadillos
- **Proyecto actual:** Market Sales
- **Tipo:** Aplicaci√≥n de control de caja para mercadillos ambulantes
- **Tecnolog√≠as:** Kotlin, Jetpack Compose, Room, Firebase

---

**ESTE DOCUMENTO CONTIENE TODA LA INFORMACI√ìN NECESARIA PARA CONTINUAR EL DESARROLLO DE MARKET SALES SIN P√âRDIDA DE CONTEXTO.**