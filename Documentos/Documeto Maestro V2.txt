# DOCUMENTO MAESTRO V2 - MARKET SALES

## ğŸ“± **INFORMACIÃ“N DEL PROYECTO**

### **Nombre del Proyecto:** Market Sales
### **Package Name:** es.nuskysoftware.marketsales
### **DescripciÃ³n:** AplicaciÃ³n para control de caja especÃ­ficamente diseÃ±ada para vendedores ambulantes en mercadillos
### **Estado Actual:** En desarrollo - NavegaciÃ³n bÃ¡sica FUNCIONANDO

---

## âœ… **COMPLETADO EN V1 â†’ V2**

### **ğŸ¯ ARCHIVOS BASE CREADOS Y FUNCIONANDO:**
- âœ… ConfiguracionEntity.kt (sin isConfigurated, controlStock, controlCoste)
- âœ… ConfiguracionDao.kt (con mÃ©todos individuales de actualizaciÃ³n)
- âœ… AppDatabase.kt (base mÃ­nima, solo configuraciÃ³n)
- âœ… ConfiguracionRepository.kt (sin Hilt, funcional)
- âœ… ConfiguracionViewModel.kt (sin Hilt, funcional)
- âœ… ConfiguracionViewModelFactory.kt (para inyecciÃ³n manual)
- âœ… Color.kt (colores completos para tema claro/oscuro)
- âœ… Shape.kt (formas Material3)
- âœ… Theme.kt (soporte fuentes y tema dinÃ¡mico)
- âœ… Type.kt (tipografÃ­as mÃºltiples)
- âœ… PantallaSplash.kt (navegaciÃ³n automÃ¡tica a mercadillos)
- âœ… PantallaMercadillos.kt (pantalla bÃ¡sica con bienvenida)
- âœ… MainActivity.kt (sin Hilt, navegaciÃ³n funcionando)

### **ğŸ”„ NAVEGACIÃ“N BÃSICA FUNCIONANDO:**
- **Flujo:** Splash (1.5s) â†’ Mercadillos automÃ¡ticamente
- **ConfiguraciÃ³n:** Se crea automÃ¡ticamente si no existe
- **Tema:** DinÃ¡mico basado en ConfiguracionEntity
- **Estado:** Compilando y ejecutando sin errores

### **ğŸš« DECISIÃ“N: SIN HILT POR AHORA**
- Elegimos **inyecciÃ³n manual** para evitar problemas de dependencias
- CÃ³digo mÃ¡s simple y transparente
- FÃ¡cil migraciÃ³n a Hilt despuÃ©s si se desea

---

## ğŸ—ï¸ **PLAN DE DESARROLLO V2 â†’ V3**

### **PASO 1: RESOLVER FIREBASE (OPCIONAL)** âš ï¸ TEMPORAL
**Problema actual:** Error google-services.json faltante
**SoluciÃ³n temporal:** Comentar lÃ­neas Firebase en build.gradle
**SoluciÃ³n definitiva:** Agregar google-services.json cuando se necesite autenticaciÃ³n

### **PASO 2: MENÃš HAMBURGUESA** ğŸ¯ PRÃ“XIMO
**Archivos a crear:**
1. `MenuHamburguesa.kt` (componente reutilizable)
2. `DrawerState.kt` (estado del menÃº)
3. Actualizar `PantallaMercadillos.kt` (soporte drawer)
4. Crear navegaciÃ³n entre pantallas

**Opciones del menÃº:**
- Mercadillos âœ… (ya existe)
- ArtÃ­culos (migrar de proyecto original)
- CategorÃ­as (migrar de proyecto original)
- Listados (placeholder)
- ConfiguraciÃ³n (nueva)
- Login/Logout (placeholder)
- Salir (cerrar app)

### **PASO 3: PANTALLAS BÃSICAS**
1. **PantallaArticulos.kt** (migrar del original, ya perfecta)
2. **PantallaCategorias.kt** (migrar y homogeneizar UI)
3. **PantallaConfiguracion.kt** (nueva, para personalizaciÃ³n)
4. **PantallaListados.kt** (placeholder bÃ¡sico)

### **PASO 4: SISTEMA DE PERSONALIZACIÃ“N COMPLETO**
**4.1 Pantalla ConfiguraciÃ³n:**
- Selector de idioma (EspaÃ±ol/InglÃ©s)
- Selector de fuente (Montserrat/Poppins/Roboto)
- Toggle tema claro/oscuro
- Selector de moneda

**4.2 InternacionalizaciÃ³n:**
- `res/values/strings.xml` (espaÃ±ol)
- `res/values-en/strings.xml` (inglÃ©s)
- `LocaleManager.kt` para cambio dinÃ¡mico
- Migrar todos los textos hardcodeados

### **PASO 5: MIGRAR FUNCIONALIDADES EXISTENTES**
1. **Sistema de avisos** (campanita)
2. **GestiÃ³n de artÃ­culos** (con lÃ³gica Premium)
3. **GestiÃ³n de categorÃ­as** (homogeneizar UI)
4. **HeaderBar** con campana funcionando

### **PASO 6: AUTENTICACIÃ“N FIREBASE** (cuando se necesite)
1. Descomenter Firebase en build.gradle
2. Agregar google-services.json
3. Implementar Firebase Auth
4. Google OAuth
5. Control acceso Premium

---

## ğŸ“ **ESTRUCTURA ACTUAL MARKET SALES**

```
app/src/main/java/es/nuskysoftware/marketsales/
â”œâ”€â”€ MainActivity.kt âœ… (funcionando)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”œâ”€â”€ dao/
â”‚   â”‚   â”‚   â””â”€â”€ ConfiguracionDao.kt âœ…
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â””â”€â”€ ConfiguracionEntity.kt âœ…
â”‚   â”‚   â””â”€â”€ database/
â”‚   â”‚       â””â”€â”€ AppDatabase.kt âœ…
â”‚   â””â”€â”€ repository/
â”‚       â””â”€â”€ ConfiguracionRepository.kt âœ…
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â”œâ”€â”€ Color.kt âœ…
â”‚   â”‚   â”œâ”€â”€ Shape.kt âœ…
â”‚   â”‚   â”œâ”€â”€ Type.kt âœ…
â”‚   â”‚   â””â”€â”€ Theme.kt âœ…
â”‚   â”œâ”€â”€ pantallas/
â”‚   â”‚   â”œâ”€â”€ PantallaSplash.kt âœ…
â”‚   â”‚   â””â”€â”€ PantallaMercadillos.kt âœ…
â”‚   â””â”€â”€ viewmodel/
â”‚       â”œâ”€â”€ ConfiguracionViewModel.kt âœ…
â”‚       â””â”€â”€ ConfiguracionViewModelFactory.kt âœ…
â””â”€â”€ [pendiente crear]/
    â”œâ”€â”€ ui/components/
    â”‚   â””â”€â”€ MenuHamburguesa.kt ğŸ“
    â””â”€â”€ utils/
        â”œâ”€â”€ LocaleManager.kt ğŸ“
        â””â”€â”€ FontManager.kt ğŸ“
```

---

## ğŸ¨ **SISTEMA DE PERSONALIZACIÃ“N IMPLEMENTADO**

### **ConfiguracionEntity.kt - Campos clave:**
```kotlin
val versionApp: Int = 0,         // 0=FREE, 1=PREMIUM
val idioma: String = "es",       // es/en
val temaOscuro: Boolean = false, // tema dinÃ¡mico
val fuente: String = "Montserrat", // fuentes dinÃ¡micas
val moneda: String = "â‚¬ Euro"
```

### **Fuentes disponibles en Type.kt:**
- **Montserrat** (default) âœ…
- **Poppins** âœ…
- **Roboto** âœ…

### **Temas implementados:**
- **Claro** (default) âœ…
- **Oscuro** âœ…
- **AplicaciÃ³n automÃ¡tica** desde ConfiguracionEntity âœ…

---

## ğŸ”§ **CONFIGURACIÃ“N TÃ‰CNICA ACTUAL**

### **Build.gradle (app) - Estado actual:**
```gradle
plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android'
    id 'kotlin-kapt'
    // id 'com.google.gms.google-services'  // COMENTADO POR AHORA
}

dependencies {
    // Room
    implementation "androidx.room:room-runtime:2.6.1"
    implementation "androidx.room:room-ktx:2.6.1"
    kapt "androidx.room:room-compiler:2.6.1"
    
    // Navigation Compose
    implementation "androidx.navigation:navigation-compose:2.7.6"
    
    // ViewModel Compose
    implementation "androidx.lifecycle:lifecycle-viewmodel-compose:2.7.0"
    
    // Firebase (COMENTADO)
    // implementation platform('com.google.firebase:firebase-bom:32.7.0')
    // implementation 'com.google.firebase:firebase-auth-ktx'
}
```

### **NavegaciÃ³n implementada:**
```kotlin
NavHost(startDestination = "splash") {
    composable("splash") { PantallaSplash(...) }
    composable("mercadillos") { PantallaMercadillos(...) }
    // TODO: Agregar mÃ¡s rutas
}
```

---

## ğŸ” **PROBLEMAS RESUELTOS EN V2**

### **âŒ Error: Hilt Android Gradle plugin**
**SoluciÃ³n:** Eliminamos Hilt, usamos inyecciÃ³n manual

### **âŒ Error: Unresolved reference ConfiguracionViewModel**
**SoluciÃ³n:** Creamos todos los archivos base en orden correcto

### **âŒ Error: google-services.json missing**
**SoluciÃ³n temporal:** Comentar Firebase hasta que se necesite

### **âœ… Estado actual:** Compila y ejecuta perfectamente

---

## ğŸ“‹ **PRÃ“XIMOS PASOS INMEDIATOS (V3)**

### **AL CONTINUAR EN NUEVO CHAT:**

**ORDEN SUGERIDO:**
1. **Verificar que compile sin errores** (comentando Firebase)
2. **Crear MenuHamburguesa.kt** (drawer navigation)
3. **Actualizar PantallaMercadillos** con menÃº hamburguesa
4. **Crear navegaciÃ³n entre pantallas** bÃ¡sicas
5. **Migrar PantallaArticulos** del proyecto original
6. **Crear PantallaConfiguracion** para personalizaciÃ³n

### **ARCHIVOS PRIORITARIOS PARA V3:**
1. `MenuHamburguesa.kt`
2. `PantallaConfiguracion.kt`
3. `PantallaArticulos.kt` (migrar)
4. `PantallaCategorias.kt` (migrar)
5. NavegaciÃ³n completa entre pantallas

---

## ğŸ¯ **MODELO A SEGUIR: PantallaArticulos ORIGINAL**

**Del proyecto "Caja Mercadillos" - ES PERFECTA:**
- âœ… VerificaciÃ³n Premium implementada
- âœ… UI responsive con orientaciÃ³n
- âœ… LazyColumn con Cards perfectas
- âœ… HeaderBar con campana funcionando
- âœ… DialogoNuevoArticulo con lÃ³gica Premium
- âœ… FAB posicionado correctamente

**Migrar tal cual y adaptar:**
- Cambiar HeaderBar para menÃº hamburguesa
- Mantener toda la lÃ³gica Premium
- Adaptar colores al nuevo tema

---

## ğŸ’¾ **BACKUP DE CÃ“DIGO IMPORTANTE**

### **MainActivity.kt (funcionando):**
```kotlin
// Base de datos y repositorio (manual, sin Hilt)
val database = AppDatabase.getDatabase(applicationContext)
val repository = ConfiguracionRepository(database.configuracionDao())

// ViewModel con factory
val configuracionViewModel: ConfiguracionViewModel = viewModel(
    factory = ConfiguracionViewModelFactory(repository)
)
```

### **ConfiguracionEntity.kt (definitiva):**
```kotlin
@Entity(tableName = "configuracion")
data class ConfiguracionEntity(
    @PrimaryKey val id: Int = 1,
    val versionApp: Int = 0,         // 0=FREE, 1=PREMIUM
    val numeroVersion: String = "V1.0",
    // ELIMINADO: isConfigurated, controlStock, controlCoste
    val ultimoDispositivo: String? = null,
    val usuarioEmail: String? = null,
    val usuarioId: String? = null,
    val idioma: String = "es",
    val temaOscuro: Boolean = false,
    val fuente: String = "Montserrat",
    val moneda: String = "â‚¬ Euro",
    val fechaUltimaSync: String? = null
)
```

---

## ğŸ”‘ **INFORMACIÃ“N CLAVE PARA CONTINUAR**

### **Firebase SHA-1 (cuando se reactive):**
```
DF:92:0E:75:F9:07:5B:A4:C7:47:5B:04:A9:88:17:C6:90:8A:2D:8A
```

### **Package name:**
```
es.nuskysoftware.marketsales
```

### **MigraciÃ³n de funcionalidades:**
- **DAOs, Entities, Repositories:** 100% reutilizables del original
- **ViewModels:** Adaptar quitando @HiltViewModel
- **UI Components:** Adaptar colores y navegaciÃ³n
- **PantallaArticulos:** Migrar completa, es el modelo perfecto

---

## ğŸ“ **ESTADO DEL PROYECTO V2**

### **âœ… COMPLETADO:**
- NavegaciÃ³n bÃ¡sica funcionando
- ConfiguracionEntity actualizada
- Sistema de personalizaciÃ³n base
- Tema dinÃ¡mico implementado
- Arquitectura sin Hilt estable

### **â³ EN PROGRESO:**
- MenÃº hamburguesa (prÃ³ximo)
- Pantallas adicionales (prÃ³ximo)

### **ğŸ“‹ PENDIENTE:**
- Sistema de personalizaciÃ³n completo
- MigraciÃ³n funcionalidades existentes
- AutenticaciÃ³n Firebase
- Nuevas funcionalidades (ventas, gastos)

---

**ESTE DOCUMENTO V2 CONTIENE TODA LA INFORMACIÃ“N ACTUALIZADA PARA CONTINUAR EL DESARROLLO SIN PÃ‰RDIDA DE CONTEXTO.**