# ðŸ“„ **DOCUMENTO MAESTRO V9 - MARKET SALES**

## ðŸ“± **INFORMACIÃ“N DEL PROYECTO**

### **Nombre del Proyecto:** Market Sales
### **Package Name:** es.nuskysoftware.marketsales
### **Estado Actual:** ðŸš€ **V9 - MÃ“DULO MERCADILLOS IMPLEMENTADO**

---

## âœ… **V9 - NUEVA FUNCIONALIDAD: GESTIÃ“N DE MERCADILLOS**

### **ðŸª MÃ“DULO MERCADILLOS - CARACTERÃSTICAS:**
- âœ… **Calendario interactivo** con navegaciÃ³n por meses
- âœ… **Estados de mercadillos** con cÃ³digo de colores personalizado
- âœ… **Card de prÃ³ximo mercadillo** siempre visible
- âœ… **Soporte multi-mercadillo** por dÃ­a
- âœ… **Sistema de prioridades** para visualizaciÃ³n
- âœ… **Leyenda de estados** con iconos descriptivos
- âœ… **Base de datos local** con Room
- âœ… **SincronizaciÃ³n Firebase** preparada

### **ðŸ“Š ESTADOS DE MERCADILLO IMPLEMENTADOS:**
1. **PROGRAMADO_PARCIAL** (1) - Azul claro - ðŸ“‹
2. **PROGRAMADO_TOTAL** (2) - Azul oscuro - ðŸ“…
3. **EN_CURSO** (3) - Verde - ðŸŸ¢
4. **PENDIENTE_ARQUEO** (4) - Naranja - âš ï¸
5. **PENDIENTE_ASIGNAR_SALDO** (5) - Rojo - ðŸ”´
6. **CERRADO_COMPLETO** (6) - Verde oscuro - âœ…
7. **CANCELADO** (7) - Gris - âŒ

---

## âœ… **SISTEMAS COMPLETADOS (V1-V8)**

### **ðŸ” AUTENTICACIÃ“N COMPLETA:**
- âœ… **Email/Password** 100% funcional
- âœ… **Google Auth** completamente integrado
- âœ… **Sistema de roles** (SUPER_ADMIN para todos temporalmente)
- âœ… **MenuHamburguesa inteligente** con estados dinÃ¡micos
- âœ… **PantallaLogin** con diseÃ±o preservado
- âœ… **PantallaPerfil** con gestiÃ³n de cuenta
- âœ… **Logout universal** para ambos mÃ©todos

### **âš™ï¸ CONFIGURACIÃ“N DINÃMICA:**
- âœ… **Idiomas** (EspaÃ±ol/English) en tiempo real
- âœ… **Fuentes** (Montserrat/Poppins/Roboto) dinÃ¡micas
- âœ… **Modo oscuro/claro** funcionando perfectamente
- âœ… **Sistema Premium/FREE** con restricciones
- âœ… **Moneda configurable** (10 opciones)
- âœ… **PantallaConfiguracion** completa con permisos

### **ðŸ—ï¸ ARQUITECTURA ROBUSTA:**
- âœ… **ConfigurationManager** singleton con StateFlows
- âœ… **StringResourceManager** localizaciÃ³n ES/EN completa
- âœ… **Room Database** v3 con migraciones
- âœ… **Firebase Firestore** sincronizaciÃ³n bidireccional
- âœ… **Offline-first** approach implementado
- âœ… **AuthRepository** con flujo hÃ­brido

---

## ðŸ“ **ESTRUCTURA V9 ACTUALIZADA**

```
app/src/main/java/es/nuskysoftware/marketsales/
â”œâ”€â”€ MainActivity.kt âœ…
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”œâ”€â”€ dao/
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfiguracionDao.kt âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ UserDao.kt âœ…
â”‚   â”‚   â”‚   â””â”€â”€ MercadilloDao.kt âœ… (NEW V9)
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfiguracionEntity.kt âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ UserEntity.kt âœ…
â”‚   â”‚   â”‚   â””â”€â”€ MercadilloEntity.kt âœ… (NEW V9)
â”‚   â”‚   â””â”€â”€ database/
â”‚   â”‚       â””â”€â”€ AppDatabase.kt âœ… (v4 con tabla mercadillos)
â”‚   â””â”€â”€ repository/
â”‚       â”œâ”€â”€ ConfiguracionRepository.kt âœ…
â”‚       â”œâ”€â”€ AuthRepository.kt âœ…
â”‚       â”œâ”€â”€ UserRepository.kt âœ…
â”‚       â””â”€â”€ MercadilloRepository.kt ðŸš§ (NEW V9 - Por implementar)
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â”œâ”€â”€ Color.kt âœ…
â”‚   â”‚   â”œâ”€â”€ Shape.kt âœ…
â”‚   â”‚   â”œâ”€â”€ Type.kt âœ…
â”‚   â”‚   â”œâ”€â”€ Theme.kt âœ…
â”‚   â”‚   â””â”€â”€ LocalConfiguration.kt âœ…
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ MenuHamburguesa.kt âœ…
â”‚   â”œâ”€â”€ pantallas/
â”‚   â”‚   â”œâ”€â”€ PantallaSplash.kt âœ…
â”‚   â”‚   â”œâ”€â”€ PantallaLogin.kt âœ…
â”‚   â”‚   â”œâ”€â”€ PantallaConfiguracion.kt âœ…
â”‚   â”‚   â”œâ”€â”€ PantallaPerfil.kt âœ…
â”‚   â”‚   â””â”€â”€ PantallaMercadillos.kt âœ… (NEW V9)
â”‚   â””â”€â”€ viewmodel/
â”‚       â”œâ”€â”€ ConfiguracionViewModel.kt âœ…
â”‚       â”œâ”€â”€ AuthViewModel.kt âœ…
â”‚       â””â”€â”€ MercadilloViewModel.kt ðŸš§ (NEW V9 - Por implementar)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ FooterMarca.kt âœ…
â”‚   â”œâ”€â”€ ConfigurationManager.kt âœ…
â”‚   â”œâ”€â”€ StringResourceManager.kt âœ… (actualizar con strings mercadillos)
â”‚   â”œâ”€â”€ GoogleAuthHelper.kt âœ…
â”‚   â””â”€â”€ EstadosMercadillo.kt âœ… (NEW V9)
â””â”€â”€ navigation/
    â””â”€â”€ Pantalla.kt âœ… (actualizar con ruta mercadillos)
```

---

## ðŸ’¾ **BASE DE DATOS V9 - TABLA MERCADILLOS**

### **Estructura de la tabla `mercadillos`:**

```kotlin
@Entity(tableName = "mercadillos")
data class MercadilloEntity(
    @PrimaryKey val id: String,           // UUID Ãºnico
    val userId: String,                   // ID del usuario propietario
    val fechaHora: Long,                  // Timestamp
    val lugar: String,                    // Lugar del mercadillo
    val organizador: String,              // Organizador
    val esGratis: Boolean = true,         // Si es gratuito
    val estado: Int = 0,                  // Estado (0-7)
    
    // Campos opcionales
    val turno: String? = null,
    val ubicacion: String? = null,
    val municipio: String? = null,
    val importeSuscripcion: Double = 0.0,
    val puntoDeLuz: Boolean = false,
    val requiereCarpa: Boolean = true,
    val requiereMesa: Boolean = true,
    val horaInicio: String? = null,
    val horaFin: String? = null,
    val saldoInicial: Double = 0.0,
    
    // Metadata
    val fechaCreacion: Long,
    val fechaModificacion: Long,
    val sincronizadoFirebase: Boolean = false
)
```

---

## ðŸŽ¯ **FUNCIONALIDADES V9 - MERCADILLOS**

### **ðŸ“… Calendario Interactivo:**
- NavegaciÃ³n mes a mes con flechas
- VisualizaciÃ³n de dÃ­as con mercadillos
- CÃ³digo de colores segÃºn estado
- Soporte para mÃºltiples mercadillos por dÃ­a
- Indicadores visuales (puntos) para dÃ­as con varios eventos

### **ðŸ“Š Sistema de Estados:**
- 7 estados predefinidos con colores Ãºnicos
- Iconos emoji descriptivos
- Sistema de prioridades para ordenamiento
- DetecciÃ³n de estados que requieren atenciÃ³n

### **ðŸ” PrÃ³ximo Mercadillo:**
- Card siempre visible con informaciÃ³n clave
- ActualizaciÃ³n automÃ¡tica basada en fecha actual
- Muestra: fecha, hora, lugar y organizador
- NavegaciÃ³n rÃ¡pida al detalle

### **ðŸ”„ SincronizaciÃ³n:**
- Base de datos local con Room
- Preparado para sincronizaciÃ³n Firebase
- Sistema offline-first
- Campos de control de sincronizaciÃ³n

---

## ðŸ“‹ **PENDIENTES V9**

### **Por implementar:**
1. **MercadilloRepository.kt** - LÃ³gica de negocio
2. **MercadilloViewModel.kt** - ViewModel para la pantalla
3. **Actualizar AppDatabase** - Agregar tabla mercadillos y migraciÃ³n
4. **Actualizar StringResourceManager** - Strings para mercadillos
5. **Actualizar MainActivity** - Agregar navegaciÃ³n a PantallaMercadillos
6. **Pantalla CrearMercadillo** - Formulario para nuevos mercadillos
7. **Pantalla DetalleMercadillo** - Vista detallada de un mercadillo

### **Strings necesarios para StringResourceManager:**
```kotlin
"mercadillos_titulo" -> "Mercadillos" / "Markets"
"proximo_mercadillo" -> "PrÃ³ximo Mercadillo" / "Next Market"
"aÃ±adir_mercadillo" -> "AÃ±adir Mercadillo" / "Add Market"
"ver_leyenda" -> "Ver leyenda" / "View legend"
"leyenda_estados" -> "Leyenda de Estados" / "Status Legend"
"entendido" -> "Entendido" / "Understood"
```

---

## ðŸš€ **PRÃ“XIMOS PASOS**

### **Inmediato (V9.1):**
1. Crear MercadilloRepository
2. Crear MercadilloViewModel
3. Actualizar AppDatabase con migraciÃ³n v4
4. Conectar PantallaMercadillos con datos reales
5. Actualizar navegaciÃ³n en MainActivity

### **Corto plazo (V9.2):**
1. Pantalla para crear/editar mercadillos
2. Pantalla de detalle de mercadillo
3. SincronizaciÃ³n con Firebase
4. Sistema de notificaciones para prÃ³ximos mercadillos

### **Medio plazo (V10):**
1. GestiÃ³n de productos por mercadillo
2. Sistema de ventas integrado
3. GeneraciÃ³n de informes
4. EstadÃ­sticas y grÃ¡ficos

---

## ðŸ”’ **REGLAS DE DESARROLLO V9**

### **PreservaciÃ³n obligatoria:**
- âœ… NUNCA modificar diseÃ±os existentes sin autorizaciÃ³n
- âœ… MANTENER compatibilidad con sistemas existentes
- âœ… RESPETAR tema oscuro/claro en nuevas pantallas
- âœ… APLICAR localizaciÃ³n ES/EN en todos los textos
- âœ… USAR StateFlows para estados reactivos

### **Nuevas reglas V9:**
- âœ… TODOS los mercadillos deben tener userId
- âœ… ESTADOS solo pueden ser valores 0-7
- âœ… FECHAS siempre en timestamp Long
- âœ… IDs siempre UUID strings
- âœ… SINCRONIZACIÃ“N debe ser no bloqueante

---

## ðŸ“Š **ESTADO DEL PROYECTO**

### **âœ… Completado (100%):**
- Sistema de autenticaciÃ³n hÃ­brido
- ConfiguraciÃ³n dinÃ¡mica completa
- Sistema de usuarios y roles
- UI/UX base establecido
- Pantalla de Mercadillos (UI)

### **ðŸš§ En progreso (60%):**
- MÃ³dulo de Mercadillos (falta conexiÃ³n con datos)
- Sistema de sincronizaciÃ³n

### **ðŸ“‹ Pendiente (0%):**
- GestiÃ³n de productos
- Sistema de ventas
- Reportes y estadÃ­sticas
- Sistema de notificaciones

---

## ðŸŽ‰ **RESUMEN V9**

**Market Sales V9** introduce el mÃ³dulo de gestiÃ³n de mercadillos con:
- âœ… Calendario visual interactivo
- âœ… Sistema de estados con colores
- âœ… Base de datos preparada
- âœ… UI/UX completo y funcional
- âœ… LocalizaciÃ³n ES/EN
- âœ… Tema oscuro/claro respetado

**Estado:** La aplicaciÃ³n estÃ¡ al **70% de completitud** para una versiÃ³n MVP funcional.

---

**VERSIÃ“N:** V9.0
**FECHA:** Enero 2025
**ESTADO:** ðŸš€ **MÃ“DULO MERCADILLOS UI COMPLETO - PENDIENTE CONEXIÃ“N DATOS**